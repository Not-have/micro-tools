# 选型

[官网](https://pnpm.io/zh/)

注：yarn、npm 也可以实现。

## 一、介绍

pnpm 是一个快速、高效的包管理工具，它的主要特点是：

- 快速：pnpm 使用了一种称为“存储”的技术，它可以将所有的依赖项都存储在一个地方，从而减少了磁盘空间的使用，并且加快了安装速度
- 高效：pnpm 使用了一种称为“链接”的技术，它可以将所有的依赖项都链接到一个地方，从而减少了磁盘空间的使用，并且加快了安装速度

## 二、技术选型

### 1、lerna + yarn

- Lerna 是一个用于管理 JavaScript/TypeScript 项目中多包（monorepo）结构的工具。它帮助管理多个包的版本、依赖关系以及发布过程。Lerna 本身并不管理包的安装，而是结合其他包管理工具（如 Yarn 或 npm）来完成安装和依赖处理

- Yarn 是一个快速、可靠且安全的 JavaScript 包管理工具，常用于管理项目的依赖项。结合 Lerna 使用时，Yarn 会负责安装多个包之间的依赖，并提供增量构建、离线安装等优化功能

#### 1）优点

- 简单易用，适合有多个包的 monorepo 项目
- 配合 Yarn，可以利用 Yarn 的缓存和优化机制来加速安装和依赖管理
- Yarn Workspaces 能够简化多个包间的依赖关系，避免重复安装相同的依赖

#### 2）缺点

- Lerna 主要是通过多个单独的命令来处理项目的管理，配置可能相对繁琐
- 依赖于 Yarn 或 npm，可能会遇到版本管理和兼容性问题

### 2、pnpm

- pnpm 是一种替代 npm 和 Yarn 的包管理工具，提供了更高效的依赖管理，特别是在 monorepo 场景下表现优越。它使用硬链接来共享相同版本的包，避免了重复安装相同依赖的情况，从而提高了安装速度并节省了磁盘空间

#### 1）优点

- 极大的优化了安装速度和磁盘空间，尤其是在多个包之间有大量共享依赖的场景
- 采用了去中心化的缓存机制，能有效避免重复安装依赖
- 配合 pnpm Workspaces 可以更高效地管理 monorepo

#### 2）缺点

- 对于部分工具链的兼容性相对较低，尤其是一些较为老旧的工具或库，可能没有很好地支持 pnpm
- 生态相对较新，可能需要一定的时间来适应并解决潜在的问题

### 3、lerna 和 pnpm 的区别

| 特性 | Lerna | pnpm |
| :---- | :---- | :---- |
| 功能定位 | 管理 monorepo 项目中的多个包 | 高效的包管理工具，特别是对于 monorepo 场景 |
| 包管理 | 结合 Yarn 或 npm 来管理依赖 | 自身就是包管理工具，使用硬链接优化安装 |
| 安装方式 | 使用 Yarn 或 npm 来安装依赖 | 使用 pnpm 本身来管理依赖 |
| 依赖管理 | 支持通过 Yarn Workspaces 管理跨包依赖 | 使用 pnpm Workspaces 来管理跨包依赖 |
| 磁盘空间优化 | 没有显著优化磁盘空间 | 使用硬链接共享依赖，节省大量磁盘空间 |
| 安装速度 | 依赖于 Yarn 的性能，整体较快 | 极大优化安装速度，尤其是在依赖重复的情况下 |
| 兼容性 | 兼容大部分 npm 和 Yarn 工具 | 对于一些工具的兼容性稍差，尤其是较旧的工具 |

### 4、总结

- Lerna + Yarn 更适合已经熟悉 Yarn 并且依赖 Yarn 的特性，如缓存和增量构建的团队。如果你主要在使用 Yarn 且项目较为成熟，Lerna 仍然是一个不错的选择

- pnpm 则更加适合对磁盘空间、安装速度有更高要求的团队，尤其是在 monorepo 项目中，pnpm 能显著减少重复安装的依赖和提升效率。但它可能需要更多时间来适应和解决兼容性问题。
